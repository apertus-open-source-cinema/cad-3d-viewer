import{d as e,c as t,a,t as s,w as i,p as n,b as r,o,r as d,F as l,e as c,S as h,G as m,V as p,D as u,f as g,M as w,B as v,A as f,g as _,h as L,C as S,i as b,P as y,O as A,W as M,j as P,s as R,k as x,T as E,E as I,l as T,m as F,n as C,q as D,u as O}from"./vendor.14d7ee6c.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const s=new URL(e,location),i=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,n)=>{const r=new URL(e,s);if(self[t].moduleMap[r])return a(self[t].moduleMap[r]);const o=new Blob([`import * as m from '${r}';`,`${t}.moduleMap['${r}']=m;`],{type:"text/javascript"}),d=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(o),onerror(){n(new Error(`Failed to import: ${e}`)),i(d)},onload(){a(self[t].moduleMap[r]),i(d)}});document.head.appendChild(d)})),self[t].moduleMap={}}}("/cad-3d-viewer/prototype/assets/");var k=e({name:"PartInfoPanel",props:{partInfo:{type:Object,required:!0},material:{type:String,default:"-"}},setup:(e,t)=>({count:0}),methods:{updateModel(){console.log("MODEL UPDATED")},createDataString(e){let t="N/A";return e&&(t=e+this.partInfo.unit),t}}});const j=i();n("data-v-6f6f26d8");const z={id:"part_info_panel"},U=a("img",{id:"axiom_logo",src:"/cad-3d-viewer/prototype/assets/axiom_logo.69b92a00.png"},null,-1),q={id:"part_name"},N=a("div",{id:"camera_name"},"AXIOM BETA",-1),H=a("div",{id:"part_info",style:{"grid-column":"2"}},[a("span",{id:"part_header"},"PART"),a("span",null,"REVISION")],-1),B={style:{"grid-column":"2/2","font-size":"1.4vw","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"}},G={style:{"font-weight":"bold","margin-right":"0.5em"}},W={id:"part_data"},$=a("div",null,"length:",-1),V=a("div",null,"width:",-1),X=a("div",null,"height:",-1),J={class:"bold_text"},K={class:"bold_text"},Q={class:"bold_text"},Y=a("div",null,"material:",-1),Z=a("a",{id:"apertus_link",href:"http://www.apertus.org",target:"_blank"},"www.apertus.org",-1);r();const ee=j(((e,i,n,r,d,l)=>(o(),t("div",z,[U,a("div",q,[N,H,a("div",B,[a("span",G,s(e.partInfo.name),1),a("span",null,s(e.partInfo.revision),1)])]),a("div",W,[$,V,X,a("div",J,s(e.createDataString(e.partInfo.length)),1),a("div",K,s(e.createDataString(e.partInfo.width)),1),a("div",Q,s(e.createDataString(e.partInfo.height)),1),Y,a("div",{class:["bold_text",{empty_data_entry:!e.partInfo.material}],style:{"grid-column":"4"}},s(e.partInfo.material||"-"),3)]),Z]))));k.render=ee,k.__scopeId="data-v-6f6f26d8";var te=e({name:"PartList",props:{parts:{type:Array,required:!0}},setup:()=>({selectedIndex:d(0)}),methods:{nextModel(){this.emitter.emit("nextModel")},updateSelected(e,t){this.selectedIndex=t,this.emitter.emit("update_selected_model",t)}}});const ae=i();n("data-v-3c5bd41a");const se={style:{overflow:"hidden",height:"100%"}},ie={class:"part_list"},ne=a("div",{class:"part_thumbnail"},null,-1);r();const re=ae(((e,i,n,r,d,h)=>(o(),t("div",se,[a("div",ie,[(o(!0),t(l,null,c(e.parts,((i,n)=>(o(),t("div",{key:i,class:["part_entry",{active:n===e.selectedIndex}],onClick:t=>e.updateSelected(i,n)},[ne,a("div",null,s(i.name),1)],10,["onClick"])))),128))])]))));te.render=re,te.__scopeId="data-v-3c5bd41a";class oe extends h{constructor(e){super(),this.material={color:11645361,roughness:.2,metalness:.9,reflectivity:0,clearcoat:.6,clearcoatRoughness:.6},this.gltfLoader=new m,this.lightTargetPosition=new p(.1,0,-.1),this.currentModelCenter=new p(0,0,0),u.onLoad=()=>{e.emit("scene_loaded")},this.SetupLight(),this.LoadEnvironment()}SetupLight(){const e=new g(16777215,5,2,w.degToRad(13),.3);e.position.set(.4,.4,.7),e.target.position.copy(this.lightTargetPosition),this.add(e.target),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.5,e.shadow.camera.far=2,e.shadow.radius=8,this.add(e),e.shadow.bias=-.001;const t=new g(16777215,10,2,w.degToRad(15),.3);t.position.set(-.4,.45,-.2),t.target.position.copy(this.lightTargetPosition),this.add(t.target),t.castShadow=!0,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,t.shadow.camera.near=.5,t.shadow.camera.far=2,t.shadow.radius=8,t.shadow.bias=-.001,this.add(t);const a=new g(16777215,5,3,w.degToRad(5),.5);a.position.set(.8,.4,-2),a.target.position.copy(this.lightTargetPosition),this.add(a.target),a.castShadow=!0,a.shadow.mapSize.width=2048,a.shadow.mapSize.height=2048,a.shadow.camera.near=.5,a.shadow.camera.far=2,a.shadow.radius=8,a.shadow.bias=-.001,this.add(a)}LoadGLTF(e,t){this.gltfLoader.load(e,t,(function(t){console.log(e+": "+t.loaded/t.total*100+"% loaded")}),(function(e){console.error(e)}))}LoadEnvironment(){this.LoadGLTF("./assets/models/environment/environment_V01.gltf",(e=>{const t=e.scene;t.traverse((function(e){e.isMesh&&(console.info("Enable shadow cast/receive"),e.castShadow=!0,e.receiveShadow=!0,e.material.map&&(e.material.map.anisotropy=16))})),this.add(t)}))}LoadModel(e){this.remove(this.currentModel);const t="assets/models/"+e;this.LoadGLTF(t,(e=>{const t=e.scene;this.currentModel=t;const a=(new v).setFromObject(t),s=Math.abs(a.min.x),i=Math.abs(a.min.y),n=Math.abs(a.max.z);t.position.set(s,i,-n);const r=(a.max.x-a.min.x)/2,o=(a.max.y-a.min.y)/2,d=(a.min.z-a.max.z)/2;this.currentModelCenter.set(r,o,d);const l=new p(r,o,d),c=new f(new p(0,1,0),l,.1,16776960);this.add(c);const h=new _(t,16776960);this.add(h),t.traverse((e=>{if(e.isMesh){e.castShadow=!0,e.receiveShadow=!0;const t=new L({color:this.material.color});t.roughness=this.material.roughness,t.metalness=this.material.metalness,t.reflectivity=this.material.reflectivity,t.clearcoat=this.material.clearcoat,t.clearcoatRoughness=this.material.clearcoatRoughness,e.material=t}})),this.add(t)}))}}class de{constructor(e,t){this.clock=new S,this.isRenderingActive=!1,this.animationEnabled=!1,this.RenderFrame=()=>{this.isRenderingActive=!1,this.renderer.render(this.scene,this.camera)},this.container=e,this.isRenderingActive=!1,T.enabled=!0,this.SetupRenderer();const a=this.container.clientWidth/this.container.clientHeight;this.cameraTargetPosition=new p(0,.06,0),this.SetupCamera(a),this.SetupScene(t),this.SetupHDR()}SetupScene(e){this.scene=new oe(e),e.on("scene_loaded",(()=>{console.log("SCENE LOADED"),this.UpdateCameraTarget()})),e.on("scene_update_required",(()=>{console.log("SCENE UPDATE"),this.updateProjectionMatrix()}))}UpdateCameraTarget(){this.currentAnim&&this.currentAnim.reset(),this.currentAnim=b({duration:1e3,begin:()=>{this.startPosition=this.controls.target,this.EnableAnimationLoop()},complete:()=>{this.DisableAnimationLoop(),this.currentAnim=null},update:e=>{this.startPosition.lerp(this.scene.currentModelCenter,e.progress/100),this.camera.lookAt(this.startPosition),this.camera.updateMatrixWorld()}})}SetupCamera(e){this.camera=new y(75,e,.01,1e3),this.camera.position.set(-.3,.3,.5),this.camera.lookAt(this.cameraTargetPosition),this.camera.setFocalLength(85),this.camera.updateProjectionMatrix(),this.controls=new A(this.camera,this.renderer.domElement),this.controls.target.copy(this.cameraTargetPosition),this.controls.maxPolarAngle=Math.PI/2,this.controls.update(),this.controls.addEventListener("change",(()=>{this.RequestFrame()}))}SetupRenderer(){this.renderer=new M({antialias:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.physicallyCorrectLights=!0,this.renderer.toneMapping=P,this.renderer.toneMappingExposure=1,this.renderer.outputEncoding=R,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=x,this.container.appendChild(this.renderer.domElement)}SetupHDR(){const e=(new E).load("assets/textures/hdri/HDR_029_Sky_Cloudy_Ref.png");e.mapping=I,e.encoding=R,this.scene.environment=e}LoadModel(e){this.scene.LoadModel(e),this.UpdateCameraTarget()}EnableAnimationLoop(){console.log("ENABLE ANIM LOOP"),this.renderer.setAnimationLoop((()=>{requestAnimationFrame(this.RenderFrame)}))}DisableAnimationLoop(){console.log("DISABLE ANIM LOOP"),this.renderer.setAnimationLoop(null)}RequestFrame(){this.isRenderingActive||(this.isRenderingActive=!0,requestAnimationFrame(this.RenderFrame))}}var le=e({name:"RenderPanel",props:{part:{type:Object,required:!0}},setup:(e,t)=>({container:d(),viewer:d()}),mounted(){F((()=>this.part),((e,t)=>{console.log("PART CHANGE "+e.name),this.viewer.LoadModel(e.modelFile)})),this.viewer=new de(this.container,this.emitter),this.viewer.LoadModel(this.part.modelFile)},methods:{}});const ce={ref:"container",style:{background:"red",width:"100%, height: 100%"}};le.render=function(e,a,s,i,n,r){return o(),t("div",ce,null,512)};var he=[{name:"Enclosure cap (bottom)",modelFile:"cap_bottom_v5.glb",revision:"v1.2",unit:"cm",length:"12.3",width:"5.8",height:"2.4",material:"aluminium"},{name:"Lens cap",modelFile:"axiom_lens_cap_v01.gltf",revision:"v2.7",unit:"cm",length:"6.4",width:"",height:"1.1"}],me={name:"App",components:{PartInfoPanel:k,PartList:te,RenderPanel:le},setup:()=>({parts:d(he),selectedIndex:d(0)}),created(){this.emitter.on("update_selected_model",(e=>{this.selectedIndex=e}))}};const pe={style:{display:"grid","grid-template-columns":"0.75fr 2.5fr 5fr",height:"100%"}};me.render=function(e,s,i,n,r,d){const l=C("PartList"),c=C("PartInfoPanel"),h=C("RenderPanel");return o(),t("div",pe,[a(l,{parts:n.parts},null,8,["parts"]),a(c,{"part-info":n.parts[n.selectedIndex]},null,8,["part-info"]),a(h,{part:n.parts[n.selectedIndex]},null,8,["part"])])};const ue=O(),ge=D(me);ge.config.globalProperties.emitter=ue,ge.mount("#app");
