import{d as e,c as t,a as s,t as i,b as a,o as n,r,F as o,e as d,S as l,U as c,f as h,g as m,V as p,h as u,G as g,i as v,D as w,j as f,M as _,B as b,A as x,k as M,C as S,l as y,E as P,m as I,s as L,n as F,P as E,O as A,W as R,p as k,q as C,T,u as z,v as D,w as O,x as q,y as U,z as G}from"./vendor.b3e8754b.js";var N=e({name:"PartInfoPanel",props:{partInfo:{type:Object,required:!0},material:{type:String,default:"-"}},setup:(e,t)=>({count:0}),mounted(){"light"==localStorage.getItem("theme")?this.$refs.theme_switch.checked=!1:this.$refs.theme_switch.checked=!0},methods:{switchTheme(e){this.emitter.emit("switch_theme",e.srcElement.checked)},updateModel(){console.log("MODEL UPDATED")},createDataString(e){let t="N/A";return e&&(t=e+" "+this.partInfo.unit),t}}});const j={id:"part_info_panel"},H={style:{position:"absolute",right:"1em",display:"flex","align-items":"center",color:"#777777"}},W=a(" Light"),B={class:"switch"},V=s("div",null,null,-1),$=a(" Dark "),X=s("img",{id:"axiom_logo",src:"/cad-3d-viewer/assets/axiom_logo_light.ca4a8c26.png"},null,-1),Z={id:"part_info"},J=s("div",{style:{"font-size":"0.8em"}}," AXIOM Beta Compact Enclosure ",-1),K={id:"part_name"},Q={id:"part_revision"},Y={style:{display:"flex"}},ee=s("div",{id:"thick_line"},null,-1),te={id:"part_data"},se=s("div",null,"length:",-1),ie=s("div",null,"width:",-1),ae=s("div",null,"height:",-1),ne=s("div",null,"material:",-1),re=s("div",null,"surface:",-1),oe={class:"bold_text"},de={class:"bold_text"},le={class:"bold_text"},ce={class:"bold_text"},he={class:"bold_text"},me={style:{display:"flex"}},pe=s("h2",null,"Links:",-1),ue={class:"source_link",href:"{{ partInfo.source }}",target:"_blank"},ge=s("a",{id:"apertus_link",href:"http://www.apertus.org",target:"_blank"},"www.apertus.org",-1);N.render=function(e,a,r,o,d,l){return n(),t("div",j,[s("div",H,[W,s("label",B,[s("input",{ref:"theme_switch",type:"checkbox",style:{position:"absolute",right:"2em"},onChange:a[1]||(a[1]=(...t)=>e.switchTheme&&e.switchTheme(...t))},null,544),V]),$]),X,s("div",Z,[s("img",{id:"part_location",src:"assets/models/parts/"+e.partInfo.id+"/location.png"},null,8,["src"]),J,s("div",K,i(e.partInfo.name),1),s("div",Q,i(e.partInfo.revision),1)]),s("div",Y,[ee,s("div",te,[se,ie,ae,ne,re,s("div",oe,i(e.createDataString(e.partInfo.length)),1),s("div",de,i(e.createDataString(e.partInfo.width)),1),s("div",le,i(e.createDataString(e.partInfo.height)),1),s("div",ce,i(e.partInfo.material||"-"),1),s("div",he,i(e.partInfo.surface||"-"),1)])]),s("div",me,[pe,s("a",ue,i(e.partInfo.sourceLabel),1),ge])])};var ve=e({name:"PartList",props:{parts:{type:Array,required:!0},selectedIndex:{type:Number,default:0}},setup:e=>({selectedIndex:r(e.selectedIndex)}),methods:{nextModel(){this.emitter.emit("nextModel")},updateSelected(e,t){this.selectedIndex=t,this.emitter.emit("update_selected_model",t)},GetIcon(e){console.log("GET ICON"),console.log(e);let t="assets/models/"+e+"/icon.png";return void 0===e&&(console.log("ICON NOT FOUND"),t="assets/icons/dummy_icon.png"),t}}});const we={style:{overflow:"hidden",height:"100%"}},fe={class:"part_list"},_e={style:{color:"var(--text_color)",background:"var(--background_part_list)",height:"100%","justify-content":"center","font-size":"0.75em",display:"flex"}};ve.render=function(e,a,r,l,c,h){return n(),t("div",we,[s("div",fe,[(n(!0),t(o,null,d(e.parts,((a,r)=>(n(),t("div",{key:a,class:["part_entry",{active:r===e.selectedIndex}],onClick:t=>e.updateSelected(a,r)},[s("img",{class:"part_thumbnail",src:"assets/models/parts/"+a.id+"/icon.png",onerror:"this.src='assets/icons/dummy_icon.png';"},null,8,["src"]),s("div",null,i(a.name),1)],10,["onClick"])))),128))]),s("div",_e,[s("div",null,i(e.selectedIndex+1)+" of "+i(e.parts.length),1)])])};const be=[m.common,m.envmap_pars_vertex,m.envmap_vertex,"uniform float time;\nuniform vec2 resolution;\n\nvoid main(){\n    gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);\n}"].join("\n"),xe=[m.common,m.envmap_pars_fragment,m.envmap_fragment,"uniform float time;\nuniform vec2 resolution;\n\nvoid main()\t{\n    float x = mod(time + gl_FragCoord.x, 20.) < 10. ? 1. : 0.;\n    float y = mod(time + gl_FragCoord.y, 20.) < 10. ? 1. : 0.;\n    /*gl_FragColor = vec4(vec3(min(x, y)), 1.);*/\n    gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);\n}"].join("\n"),Me={time:{type:"f",value:1},resolution:{type:"v2",value:new p}};Me.resolution.value.x=300,Me.resolution.value.y=300,new l({uniforms:c.merge([h.fog,Me]),vertexShader:be,fragmentShader:xe});class Se extends u{constructor(e){super(),this.material={color:11645361,roughness:.2,metalness:.9,reflectivity:0,clearcoat:.6,clearcoatRoughness:.6},this.eventEmitter=e,this.gltfLoader=new g,this.lightTargetPosition=new v(.1,0,-.1),this.currentModelCenter=new v(0,0,0),w.onLoad=()=>{e.emit("scene_loaded")},this.SetupLight(),this.LoadEnvironment()}SetupLight(){const e=new f(16777215,3,2,_.degToRad(20),.3);e.position.set(.4,.4,.7),e.target.position.copy(this.lightTargetPosition),this.add(e.target),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.5,e.shadow.camera.far=2,e.shadow.radius=8,this.add(e),e.shadow.bias=-.001;const t=new f(16777215,7,2,_.degToRad(25),.3);t.position.set(-.4,.45,-.2),t.target.position.copy(this.lightTargetPosition),this.add(t.target),t.castShadow=!0,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,t.shadow.camera.near=.5,t.shadow.camera.far=2,t.shadow.radius=8,t.shadow.bias=-.001,this.add(t);const s=new f(16777215,3,3,_.degToRad(15),.5);s.position.set(.8,.4,-2),s.target.position.copy(this.lightTargetPosition),this.add(s.target),s.castShadow=!0,s.shadow.mapSize.width=2048,s.shadow.mapSize.height=2048,s.shadow.camera.near=.5,s.shadow.camera.far=2,s.shadow.radius=8,s.shadow.bias=-.001,this.add(s)}LoadGLTF(e,t){this.gltfLoader.load(e,t,(function(t){console.log(e+": "+t.loaded/t.total*100+"% loaded")}),(function(e){console.error(e)}))}LoadEnvironment(){this.LoadGLTF("./assets/models/environment/environment_V02.gltf",(e=>{const t=e.scene;t.traverse((function(e){e.isMesh&&(console.info("Enable shadow cast/receive"),e.castShadow=!0,e.receiveShadow=!0,e.material.map&&(e.material.map.anisotropy=16))})),this.add(t)}))}LoadModel(e){this.remove(this.currentModel);const t="assets/models/"+e;this.LoadGLTF(t,(e=>{const t=e.scene;this.currentModel=t;const s=(new b).setFromObject(t),i=Math.abs(s.min.x),a=Math.abs(s.min.y),n=Math.abs(s.max.z);t.position.set(i,a,-n);const r=(s.max.x-s.min.x)/2,o=(s.max.y-s.min.y)/2,d=(s.min.z-s.max.z)/2;this.currentModelCenter.set(r,o,d);const l=new v(r,o,d);new x(new v(0,1,0),l,.1,16776960),new M(t,16776960),t.traverse((e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),this.add(t),this.eventEmitter.emit("scene_model_loaded")}))}}class ye{constructor(e,t){this.clock=new S,this.isRenderingActive=!1,this.animationEnabled=!1,this.RenderFrame=()=>{this.isRenderingActive=!1,this.composer.render()},this.container=e,this.isRenderingActive=!1,D.enabled=!0,this.SetupRenderer();const s=this.container.clientWidth/this.container.clientHeight;this.cameraTargetPosition=new v(0,.06,0),this.SetupCamera(s),this.SetupScene(t),this.SetupPostProcessingScene(),this.SetupHDR(),this.SetupGUI()}SetupGUI(){this.gui=new y.exports.Pane}SetupScene(e){this.scene=new Se(e),e.on("scene_model_loaded",(()=>{console.log("SCENE MODEL LOADED"),this.ssrPass.selects=this.scene.currentModel.children,this.ssrPass.selective=!0,this.materialFolder&&this.materialFolder.dispose(),this.postprocessingFolder&&this.postprocessingFolder.dispose(),this.materialFolder=this.gui.addFolder({title:"Material",expanded:!0}),this.materialFolder.addInput(this.scene.currentModel.children[0].material,"color").on("change",(e=>{const t=e.value;this.scene.currentModel.children[0].material.color.setRGB(t.r/255,t.g/255,t.b/255),this.UpdateMaterial()})),this.materialFolder.addInput(this.scene.currentModel.children[0].material,"roughness",{min:0,max:1}).on("change",(e=>{const t=e.value;this.scene.currentModel.children[0].material.roughness=t,this.UpdateMaterial()})),this.materialFolder.addInput(this.scene.currentModel.children[0].material,"metalness",{min:0,max:1}).on("change",(e=>{const t=e.value;this.scene.currentModel.children[0].material.metalness=t,this.UpdateMaterial()})),this.materialFolder.addInput(this.scene.currentModel.children[0].material,"envMapIntensity",{min:0,max:3}).on("change",(e=>{const t=e.value;this.scene.currentModel.children[0].material.envMapIntensity=t,this.UpdateMaterial()})),this.postprocessingFolder=this.gui.addFolder({title:"Post-processing",expanded:!0}),this.postprocessingFolder.addInput(this.ssrPass,"opacity",{min:0,max:1}).on("change",(e=>{const t=e.value;this.ssrPass.opacity=t,this.RequestFrame()})),this.postprocessingFolder.addInput(this.ssrPass,"maxDistance",{min:0,max:.3}).on("change",(e=>{const t=e.value;this.ssrPass.maxDistance=t,this.RequestFrame()})),this.RequestFrame()})),e.on("scene_update_required",(()=>{console.log("SCENE UPDATE"),this.RequestFrame()}))}UpdateMaterial(){this.scene.currentModel.children[0].material.needsUpdate=!0,this.RequestFrame()}SetupPostProcessingScene(){this.composer=new P(this.renderer),this.composer.setSize(2*this.container.clientWidth,this.container.clientHeight),this.ssrPass=new I({renderer:this.renderer,scene:this.scene,camera:this.camera,width:innerWidth,height:innerHeight,encoding:L,isPerspectiveCamera:!0,groundReflector:null,isBouncing:!1,selects:null}),this.composer.addPass(this.ssrPass)}UpdateCameraTarget(){this.currentAnim&&this.currentAnim.reset(),this.currentAnim=F({duration:1e3,begin:()=>{this.startPosition=this.controls.target,this.EnableAnimationLoop()},complete:()=>{this.DisableAnimationLoop(),this.currentAnim=null},update:e=>{this.startPosition.lerp(this.scene.currentModelCenter,e.progress/100),this.camera.lookAt(this.startPosition)}})}SetupCamera(e){this.camera=new E(75,e,.01,1e3),this.camera.position.set(-.1,.2,.2),this.camera.lookAt(this.cameraTargetPosition),this.camera.setFocalLength(85),this.camera.updateProjectionMatrix(),this.controls=new A(this.camera,this.renderer.domElement),this.controls.target.copy(this.cameraTargetPosition),this.controls.maxPolarAngle=Math.PI/2,this.controls.update(),this.controls.addEventListener("change",(()=>{this.RequestFrame()}))}SetupRenderer(){this.renderer=new R({antialias:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.physicallyCorrectLights=!0,this.renderer.toneMapping=k,this.renderer.toneMappingExposure=1,this.renderer.outputEncoding=L,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=C,console.log("WebGL2: "+this.renderer.capabilities.isWebGL2),this.container.appendChild(this.renderer.domElement)}SetupHDR(){const e=(new T).load("assets/textures/hdri/abstract_room.png");e.mapping=z,e.encoding=L,this.scene.environment=e}LoadModel(e){this.scene.LoadModel(e),this.UpdateCameraTarget()}Resize(e,t){console.log("RENDERER RESIZE: "+e+" / "+t),this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t),this.RequestFrame()}EnableAnimationLoop(){console.log("ENABLE ANIM LOOP"),this.renderer.setAnimationLoop((()=>{requestAnimationFrame(this.RenderFrame)}))}DisableAnimationLoop(){console.log("DISABLE ANIM LOOP"),this.renderer.setAnimationLoop(null)}RequestFrame(){this.isRenderingActive||(this.isRenderingActive=!0,requestAnimationFrame(this.RenderFrame))}}var Pe=e({name:"RenderPanel",props:{part:{type:Object,required:!0}},setup:(e,t)=>({container:r(),viewer:r()}),mounted(){O((()=>this.part),((e,t)=>{console.log("PART CHANGE parts/"+e.id+"/"+e.modelFile),this.viewer.LoadModel("parts/"+e.id+"/"+e.modelFile)})),this.viewer=new ye(this.container,this.emitter),this.viewer.LoadModel("parts/"+this.part.id+"/"+this.part.modelFile),window.addEventListener("resize",(()=>{this.onResize()}))},methods:{onResize(){console.log(this.container),this.container.clientWidth&&this.container.clientHeight&&this.viewer.Resize(this.container.clientWidth,this.container.clientHeight)}}});const Ie={ref:"container",style:{background:"red",width:"100%, height: 100%"}};Pe.render=function(e,s,i,a,r,o){return n(),t("div",Ie,null,512)};var Le={parts:[{name:"Cap Bottom",modelFile:"cap_bottom_v5.glb",id:"cap_bottom_v5",revision:" Version 5",unit:"mm",length:"123",width:"58",height:"24",material:"aluminium",surface:"sandblasted & anodized silver",shader:"aluminum_anodized_natural",source:"https://cad.onshape.com/documents/9aa42c10d73de66c7f7ef0a4/w/d1382fd006d56e4c3066c63f/e/9774cccf40a0ea48cbc9e041",sourceLabel:"Open in Onshape"},{name:"E-Mount Lens Cap",id:"axiom_lens_cap_v01",modelFile:"axiom_lens_cap_v01.glb",revision:"Version 1",unit:"mm",length:"64",width:"",height:"11",material:"PLA",surface:"",shader:"plastic_black",source:"https://github.com/apertus-open-source-cinema/beta-hardware/tree/master/E-Mount%20Cap",sourceLabel:"Source on Github"},{name:"E-Mount",id:"axiom_e_mount_v4",modelFile:"axiom_e_mount_v4.glb",revision:"Version 4",unit:"mm",length:"66",width:"66",height:"7.8",material:"aluminium",surface:"sandblasted & anodized black",shader:"aluminum_anodized_black",source:"https://cad.onshape.com/documents/9aa42c10d73de66c7f7ef0a4/w/d1382fd006d56e4c3066c63f/e/03e0f16fae083ab06071e1b4",sourceLabel:"Open in Onshape"},{name:"Assembly Test",id:"assembly_test_v1",modelFile:"assembly_test_v1.glb",revision:"Version 1",unit:"",length:"",width:"",height:"",material:"",surface:"",shader:""}]},Fe={name:"App",components:{PartInfoPanel:N,PartList:ve,RenderPanel:Pe},setup(){const e=r(Le.parts);let t=0;const s=new URLSearchParams(window.location.search).get("part");s&&(t=Le.parts.findIndex(((e,t)=>e.id===s)));const i=r(t);return"light"==localStorage.getItem("theme")?document.documentElement.setAttribute("data-theme","light"):document.documentElement.setAttribute("data-theme","dark"),{parts:e,selectedIndex:i}},created(){this.emitter.on("update_selected_model",(e=>{this.selectedIndex=e})),this.emitter.on("switch_theme",(e=>{e?(document.documentElement.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")):(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("theme","light"))}))}};const Ee={style:{display:"grid","grid-template-columns":"7em 25em auto",height:"100%"}};Fe.render=function(e,i,a,r,o,d){const l=q("PartList"),c=q("PartInfoPanel"),h=q("RenderPanel");return n(),t("div",Ee,[s(l,{parts:r.parts,"selected-index":r.selectedIndex},null,8,["parts","selected-index"]),s(c,{"part-info":r.parts[r.selectedIndex]},null,8,["part-info"]),s(h,{part:r.parts[r.selectedIndex]},null,8,["part"])])};const Ae=G(),Re=U(Fe);Re.config.globalProperties.emitter=Ae,Re.mount("#app");
